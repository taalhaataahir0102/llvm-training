<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>39e19ba7b5ca4e7f8d24bf6424078407</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="pass-discription">Pass Discription</h1>
<p>Check the total number of print statements executed dynamically
during run time. Create a void function which will be inserted at the
top of each printf in the IR using Builder. Create a C file which will
have a counter and declaration of your newly inserted function. The
counter will update when the function will be called. Create object
files for both, test.c and declaration.c and link them together. Now
generate a new executable. This executable will tell you how many times
printf was called in your code. Look at the functions class in llvm to
see how to create a simple void function which does nothing.</p>
<h1 id="code">Code</h1>
<p>Here is the pass.cpp file:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode C"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;llvm/Transforms/Utils/NewCall.h&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;llvm/IR/InstIterator.h&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;llvm/IR/Instructions.h&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;llvm/Pass.h&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;llvm/IR/Function.h&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;llvm/IR/IRBuilder.h&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;llvm/IR/Value.h&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>using namespace llvm<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>PreservedAnalyses NewCallPass<span class="op">::</span>run<span class="op">(</span>Module <span class="op">&amp;</span>M<span class="op">,</span> ModuleAnalysisManager <span class="op">&amp;</span>AM<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    LLVMContext <span class="op">&amp;</span>Context <span class="op">=</span> M<span class="op">.</span>getContext<span class="op">();</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Creating a prototype for the &#39;func&#39; function</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    FunctionType <span class="op">*</span>FuncType <span class="op">=</span> FunctionType<span class="op">::</span>get<span class="op">(</span>Type<span class="op">::</span>getVoidTy<span class="op">(</span>Context<span class="op">),</span> false<span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    Function <span class="op">*</span>FuncDecl <span class="op">=</span> Function<span class="op">::</span>Create<span class="op">(</span>FuncType<span class="op">,</span> Function<span class="op">::</span>ExternalLinkage<span class="op">,</span> <span class="st">&quot;func&quot;</span><span class="op">,</span> <span class="op">&amp;</span>M<span class="op">);</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>Function <span class="op">&amp;</span>F <span class="op">:</span> M<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    errs<span class="op">()</span> <span class="op">&lt;&lt;</span> F<span class="op">.</span>getName<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>BasicBlock <span class="op">&amp;</span>BB <span class="op">:</span> F<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span>Instruction <span class="op">&amp;</span>I <span class="op">:</span> BB<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>CallInst <span class="op">*</span>Call <span class="op">=</span> dyn_cast<span class="op">&lt;</span>CallInst<span class="op">&gt;(&amp;</span>I<span class="op">))</span> <span class="op">{</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                Function <span class="op">*</span>Callee <span class="op">=</span> Call<span class="op">-&gt;</span>getCalledFunction<span class="op">();</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                errs<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;Function called: &quot;</span> <span class="op">&lt;&lt;</span> Callee<span class="op">-&gt;</span>getName<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span>Callee<span class="op">-&gt;</span>getName<span class="op">()</span> <span class="op">==</span> <span class="st">&quot;printf&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                    errs<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;Yes, it&#39;s printf!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                    IRBuilder<span class="op">&lt;&gt;</span> Builder<span class="op">(</span>Call<span class="op">);</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                    Builder<span class="op">.</span>CreateCall<span class="op">(</span>FuncDecl<span class="op">);</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> PreservedAnalyses<span class="op">::</span>all<span class="op">();</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The comments inside the code are self-explainatory.</p>
<h1 id="input-c-file">Input C file</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode C"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// newcall.c file</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> here<span class="op">(){</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;in int func&quot;</span><span class="op">);</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> here2<span class="op">(){</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;in another int funct&quot;</span><span class="op">);</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main <span class="op">(){</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> j <span class="op">=</span> <span class="dv">64</span><span class="op">;</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>i <span class="op">&gt;</span> j<span class="op">){</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;yes&quot;</span><span class="op">);</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> o <span class="op">=</span> i <span class="op">*</span> j<span class="op">;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>o <span class="op">&lt;</span> <span class="dv">0</span><span class="op">){</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>   o <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>   printf<span class="op">(</span><span class="st">&quot;yes2&quot;</span><span class="op">);</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span><span class="op">{</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a> printf<span class="op">(</span><span class="st">&quot;yes3&quot;</span><span class="op">);</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> b <span class="op">=</span> here<span class="op">();</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;values: %d %d&quot;</span><span class="op">,</span>i<span class="op">,</span>j<span class="op">);</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>j<span class="op">+=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="ir-generated-from-c">IR Generated from C</h1>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clang</span> <span class="at">-S</span> <span class="at">-O0</span> <span class="at">-Xclang</span> <span class="at">-disable-O0-optnone</span> <span class="at">-emit-llvm</span> <span class="at">-fno-discard-value-names</span> newcall.c <span class="at">-o</span> newcall.ll</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode C"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// newcall.ll file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>define dso_local signext i32 @here<span class="op">()</span> #<span class="dv">0</span> <span class="op">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>entry<span class="op">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="op">)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>ret i32 <span class="dv">1</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>declare dso_local signext i32 @printf<span class="op">(</span>ptr noundef<span class="op">,</span> <span class="op">...)</span> #<span class="dv">1</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="op">;</span> Function Attrs<span class="op">:</span> noinline nounwind uwtable</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>define dso_local signext i32 @here2<span class="op">()</span> #<span class="dv">0</span> <span class="op">{</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>entry<span class="op">:</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.1</span><span class="op">)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>ret i32 <span class="dv">2</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="op">;</span> Function Attrs<span class="op">:</span> noinline nounwind uwtable</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>define dso_local signext i32 @main<span class="op">()</span> #<span class="dv">0</span> <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>entry<span class="op">:</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>retval <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>i <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>j <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>o <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>b <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>store i32 <span class="dv">0</span><span class="op">,</span> ptr <span class="op">%</span>retval<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>store i32 <span class="dv">8</span><span class="op">,</span> ptr <span class="op">%</span>i<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>store i32 <span class="dv">64</span><span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">0</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>i<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">1</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>cmp <span class="op">=</span> icmp sgt i32 <span class="op">%</span><span class="dv">0</span><span class="op">,</span> <span class="op">%</span><span class="dv">1</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>br i1 <span class="op">%</span>cmp<span class="op">,</span> label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>then<span class="op">,</span> label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span>then<span class="op">:</span>                                          <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span>entry</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.2</span><span class="op">)</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>br label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span>end<span class="op">:</span>                                           <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span>then<span class="op">,</span> <span class="op">%</span>entry</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">2</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>i<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">3</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>mul <span class="op">=</span> mul nsw i32 <span class="op">%</span><span class="dv">2</span><span class="op">,</span> <span class="op">%</span><span class="dv">3</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>store i32 <span class="op">%</span>mul<span class="op">,</span> ptr <span class="op">%</span>o<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">4</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>o<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>cmp1 <span class="op">=</span> icmp slt i32 <span class="op">%</span><span class="dv">4</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>br i1 <span class="op">%</span>cmp1<span class="op">,</span> label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>then2<span class="op">,</span> label <span class="op">%</span><span class="cf">if</span><span class="op">.</span><span class="cf">else</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span>then2<span class="op">:</span>                                         <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>store i32 <span class="dv">1</span><span class="op">,</span> ptr <span class="op">%</span>o<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call3 <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.3</span><span class="op">)</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>br label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end5</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span><span class="cf">else</span><span class="op">:</span>                                          <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call4 <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.4</span><span class="op">)</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>br label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end5</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span>end5<span class="op">:</span>                                          <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span><span class="cf">else</span><span class="op">,</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span>then2</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call6 <span class="op">=</span> call signext i32 @here<span class="op">()</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>store i32 <span class="op">%</span>call6<span class="op">,</span> ptr <span class="op">%</span>b<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">5</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>i<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">6</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call7 <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.5</span><span class="op">,</span> i32 noundef signext <span class="op">%</span><span class="dv">5</span><span class="op">,</span> i32 noundef signext <span class="op">%</span><span class="dv">6</span><span class="op">)</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">7</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>add <span class="op">=</span> add nsw i32 <span class="op">%</span><span class="dv">7</span><span class="op">,</span> <span class="dv">1</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>store i32 <span class="op">%</span>add<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>ret i32 <span class="dv">0</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h1 id="output">Output</h1>
<p>Running the pass</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./opt</span> <span class="at">-passes</span><span class="op">=</span>newcall newcall.ll <span class="at">-S</span> <span class="at">-o</span> printfnewcall.ll</span></code></pre></div>
<p>New IR generated:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode C"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// printfnewcall.ll file</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>define dso_local signext i32 @here<span class="op">()</span> #<span class="dv">0</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>entry<span class="op">:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>call <span class="dt">void</span> @func<span class="op">()</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="op">)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>ret i32 <span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>declare dso_local signext i32 @printf<span class="op">(</span>ptr noundef<span class="op">,</span> <span class="op">...)</span> #<span class="dv">1</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="op">;</span> Function Attrs<span class="op">:</span> noinline nounwind uwtable</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>define dso_local signext i32 @here2<span class="op">()</span> #<span class="dv">0</span> <span class="op">{</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>entry<span class="op">:</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>call <span class="dt">void</span> @func<span class="op">()</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.1</span><span class="op">)</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>ret i32 <span class="dv">2</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="op">;</span> Function Attrs<span class="op">:</span> noinline nounwind uwtable</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>define dso_local signext i32 @main<span class="op">()</span> #<span class="dv">0</span> <span class="op">{</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>entry<span class="op">:</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>retval <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>i <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>j <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>o <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>b <span class="op">=</span> alloca i32<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>store i32 <span class="dv">0</span><span class="op">,</span> ptr <span class="op">%</span>retval<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>store i32 <span class="dv">8</span><span class="op">,</span> ptr <span class="op">%</span>i<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>store i32 <span class="dv">64</span><span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">0</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>i<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">1</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>cmp <span class="op">=</span> icmp sgt i32 <span class="op">%</span><span class="dv">0</span><span class="op">,</span> <span class="op">%</span><span class="dv">1</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>br i1 <span class="op">%</span>cmp<span class="op">,</span> label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>then<span class="op">,</span> label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span>then<span class="op">:</span>                                          <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span>entry</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>call <span class="dt">void</span> @func<span class="op">()</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.2</span><span class="op">)</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>br label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span>end<span class="op">:</span>                                           <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span>then<span class="op">,</span> <span class="op">%</span>entry</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">2</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>i<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">3</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>mul <span class="op">=</span> mul nsw i32 <span class="op">%</span><span class="dv">2</span><span class="op">,</span> <span class="op">%</span><span class="dv">3</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>store i32 <span class="op">%</span>mul<span class="op">,</span> ptr <span class="op">%</span>o<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">4</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>o<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>cmp1 <span class="op">=</span> icmp slt i32 <span class="op">%</span><span class="dv">4</span><span class="op">,</span> <span class="dv">0</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>br i1 <span class="op">%</span>cmp1<span class="op">,</span> label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>then2<span class="op">,</span> label <span class="op">%</span><span class="cf">if</span><span class="op">.</span><span class="cf">else</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span>then2<span class="op">:</span>                                         <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>store i32 <span class="dv">1</span><span class="op">,</span> ptr <span class="op">%</span>o<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>call <span class="dt">void</span> @func<span class="op">()</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call3 <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.3</span><span class="op">)</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>br label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end5</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span><span class="cf">else</span><span class="op">:</span>                                          <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>call <span class="dt">void</span> @func<span class="op">()</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call4 <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.4</span><span class="op">)</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>br label <span class="op">%</span><span class="cf">if</span><span class="op">.</span>end5</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">.</span>end5<span class="op">:</span>                                          <span class="op">;</span> preds <span class="op">=</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span><span class="cf">else</span><span class="op">,</span> <span class="op">%</span><span class="cf">if</span><span class="op">.</span>then2</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call6 <span class="op">=</span> call signext i32 @here<span class="op">()</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>store i32 <span class="op">%</span>call6<span class="op">,</span> ptr <span class="op">%</span>b<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">5</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>i<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">6</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>call <span class="dt">void</span> @func<span class="op">()</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>call7 <span class="op">=</span> call signext i32 <span class="op">(</span>ptr<span class="op">,</span> <span class="op">...)</span> @printf<span class="op">(</span>ptr noundef @<span class="op">.</span>str<span class="fl">.5</span><span class="op">,</span> i32 noundef signext <span class="op">%</span><span class="dv">5</span><span class="op">,</span> i32 noundef signext <span class="op">%</span><span class="dv">6</span><span class="op">)</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="op">%</span><span class="dv">7</span> <span class="op">=</span> load i32<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>add <span class="op">=</span> add nsw i32 <span class="op">%</span><span class="dv">7</span><span class="op">,</span> <span class="dv">1</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>store i32 <span class="op">%</span>add<span class="op">,</span> ptr <span class="op">%</span>j<span class="op">,</span> align <span class="dv">4</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>ret i32 <span class="dv">0</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>declare <span class="dt">void</span> @func<span class="op">()</span></span></code></pre></div>
<p>Here we cann se that a new function named func is created and
inserted at the top of each printf statement.</p>
<p>Now we create a new C file having the declation of this function and
a counter which will update whenever this function is called.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode C"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> Numprintf <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> fun<span class="op">(){</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Number of printf function executed during runtime until now:%d</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,++</span>Numprintf<span class="op">);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Create object files for both and link them:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./clang</span> <span class="at">-c</span> wow.c</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./llvm-as</span> printfnewcall.ll <span class="at">-o</span> newcall.bc</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">./clang</span> <span class="at">-c</span> newcall.bc</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./clang</span> wow.o newcall.o <span class="at">-o</span> output</span></code></pre></div>
<p>Now run the output executable:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./qemu-riscv64</span> output</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode C"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Number of printf function executed during runtime until now<span class="op">:</span><span class="dv">1</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Number of printf function executed during runtime until now<span class="op">:</span><span class="dv">2</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>Number of printf function executed during runtime until now<span class="op">:</span><span class="dv">3</span></span></code></pre></div>
</body>
</html>
